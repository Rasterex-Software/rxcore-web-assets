!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension"),require("UIExtension").PDFViewCtrl.commons,require("UIExtension").PDFViewCtrl):"function"==typeof define&&define.amd?define(["UIExtension",["UIExtension","PDFViewCtrl","commons"],["UIExtension","PDFViewCtrl"]],t):"object"==typeof exports?exports.UIExtension_EditGraphicsAddon=t(require("UIExtension"),require("UIExtension").PDFViewCtrl.commons,require("UIExtension").PDFViewCtrl):e.UIExtension_EditGraphicsAddon=t(e.UIExtension,e.UIExtension.PDFViewCtrl.commons,e.UIExtension.PDFViewCtrl)}(self,((e,t,n)=>(()=>{var r={125:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer class="fv__ui-annot-properties-dialog fv__ui-graphics-object-properties-dialog" @var.dialog="$component" @isolate>\n<layer-header\n@sync.title="dialog.title"\n@draggable="{type: \'parent\'}">\n</layer-header>\n<layer-view class="body">\n<div class="tabPanel" name="tabPanel">\n<gtab\ngroup="graphics-properties-dialog-tab"\nbody="graphics-properties-dialog-appearance-tab-body"\ntext="sidebar.layers.importDialog.appearance"\nactive\nname="appearance-tab"\n></gtab>\n</div>\n<div\nname="graphics-properties-dialog-appearance-tab-body"\nclass="tabBody annot-properties-dialog-body"\n@init="dialog.appearanceTabBody=$component"\n>\n<div class="input-component borderWidth" @init="dialog.borderWidthFieldset = $component">\n<span>dialog.actionDialog.appearance.thickness</span>\n<number\nmin="0" max="12" step="1" \n@aria:labelledby="::previousSiblings()"\n@model="dialog.properties.borderWidth"\n@init="dialog.borderWidthElement = $component"\n name="borderWidth"\n></number>\n</div>\n<div class="input-component borderStyle" @init="dialog.borderStyleFieldset = $component">\n<span>annotPropertiesDialog.borderStyle</span>\n<choice\nclass="fv__property-component"\nname="graphics-property-borderStyle"\n@aria:labelledby="::previousSiblings()"\n@on.change="dialog.borderStyleChanged($component.getValue())"\n@init="dialog.borderStyleChoice = $component"\n name="borderStyle"\n></choice>\n</div>\n<div class="input-component fillColor" @init="dialog.fillColorFieldset = $component">\n<span>dialog.formPropertiesDialog.appearance.fillColor</span>\n<button class="color-picker" @aria:labelledby="::previousSiblings()" @on.native.click="dialog.showColorPicker(\'fillColor\',$component, $event)" name="fillColor-picker">\n<div class="fv__ui-color-picker-previewer">\n<div class="label">?</div>\n<div class="mask" @init="dialog.fillColorMaskElement = $component.element"></div>\n</div>\n</button>\n</div>\n<div class="input-component color" @init="dialog.borderColorFieldset = $component">\n<span>dialog.actionDialog.appearance.color</span>\n<button class="color-picker" @aria:labelledby="::previousSiblings()" @on.native.click="dialog.showColorPicker(\'borderColor\',$component, $event)" name="borderColor-picker">\n<div class="fv__ui-color-picker-previewer">\n<div class="label">?</div>\n<div class="mask" @init="dialog.borderColorMaskElement = $component.element"></div>\n</div>\n</button>\n</div>\n<div class="input-component opacity" @init="dialog.opacityInputFieldset = $component">\n<span>sidebar.layers.importDialog.opacity</span>\n<number\nmin="0" max="100" step="1"\n@aria:labelledby="::previousSiblings()"\n@model="dialog.properties.opacity"\n@init="dialog.opacityInput = $component"\nname="opacity"\n></number>\n<label>%</label>\n</div>\n<slider\nclass="fv__property-component opacity-slider"\nunit=\'%\'\nmax="100"\nmin="0"\nstep="1"\n@model="dialog.properties.opacity"\nname="annot-property-opacitySlider"\n@stop-drag\nhideinput="true"\n@aria:labelledby="::previousSiblings()::childAt(0)"\n@init="dialog.opacitySlider = $component"\n></slider>\n</div>\n</layer-view>\n<div class="footer">\n<div class="fv__left-buttons">\n<checkbox \n@cannotBeDisabled\ntext="sidebar.layers.properties.locked"\n@on.change="dialog.toggleLock($component.getValue())"\nvisible="false"\nname="fv__ui-property-locked"\n></checkbox>\n</div>\n<xbutton\ntext="dialog.close"\nclass="fv__ui-dialog-button fv__ui-dialog-ok-button fv__ui-annot-property-close"\n@on.click="dialog.hide()"\n@cannotBeDisabled\nname="fv__ui-property-close"\n></xbutton>\n</div>\n</layer>\n','<layer class="fv__ui-annot-properties-dialog fv__ui-graphics-object-properties-dialog" @var.dialog="$component" @isolate>\n<layer-header\n@sync.title="dialog.title"\n@draggable="{type: \'parent\'}">\n</layer-header>\n<layer-view class="body">\n<div class="tabPanel" name="tabPanel">\n<gtab\ngroup="graphics-properties-dialog-tab"\nbody="graphics-properties-dialog-appearance-tab-body"\ntext="sidebar.layers.importDialog.appearance"\nactive\nname="appearance-tab"\n></gtab>\n</div>\n<div\nname="graphics-properties-dialog-appearance-tab-body"\nclass="tabBody annot-properties-dialog-body"\n@init="dialog.appearanceTabBody=$component"\n>\n<div class="input-component borderWidth" @init="dialog.borderWidthFieldset = $component">\n<span>dialog.actionDialog.appearance.thickness</span>\n<number\nmin="0" max="12" step="1" \n@aria:labelledby="::previousSiblings()"\n@model="dialog.properties.borderWidth"\n@init="dialog.borderWidthElement = $component"\n name="borderWidth"\n></number>\n</div>\n<div class="input-component borderStyle" @init="dialog.borderStyleFieldset = $component">\n<span>annotPropertiesDialog.borderStyle</span>\n<choice\nclass="fv__property-component"\nname="graphics-property-borderStyle"\n@aria:labelledby="::previousSiblings()"\n@on.change="dialog.borderStyleChanged($component.getValue())"\n@init="dialog.borderStyleChoice = $component"\n name="borderStyle"\n></choice>\n</div>\n<div class="input-component fillColor" @init="dialog.fillColorFieldset = $component">\n<span>dialog.formPropertiesDialog.appearance.fillColor</span>\n<button class="color-picker" @aria:labelledby="::previousSiblings()" @on.native.click="dialog.showColorPicker(\'fillColor\',$component, $event)" name="fillColor-picker">\n<div class="fv__ui-color-picker-previewer">\n<div class="label">?</div>\n<div class="mask" @init="dialog.fillColorMaskElement = $component.element"></div>\n</div>\n</button>\n</div>\n<div class="input-component color" @init="dialog.borderColorFieldset = $component">\n<span>dialog.actionDialog.appearance.color</span>\n<button class="color-picker" @aria:labelledby="::previousSiblings()" @on.native.click="dialog.showColorPicker(\'borderColor\',$component, $event)" name="borderColor-picker">\n<div class="fv__ui-color-picker-previewer">\n<div class="label">?</div>\n<div class="mask" @init="dialog.borderColorMaskElement = $component.element"></div>\n</div>\n</button>\n</div>\n<div class="input-component opacity" @init="dialog.opacityInputFieldset = $component">\n<span>sidebar.layers.importDialog.opacity</span>\n<number\nmin="0" max="100" step="1"\n@aria:labelledby="::previousSiblings()"\n@model="dialog.properties.opacity"\n@init="dialog.opacityInput = $component"\nname="opacity"\n></number>\n<label>%</label>\n</div>\n<slider\nclass="fv__property-component opacity-slider"\nunit=\'%\'\nmax="100"\nmin="0"\nstep="1"\n@model="dialog.properties.opacity"\nname="annot-property-opacitySlider"\n@stop-drag\nhideinput="true"\n@aria:labelledby="::previousSiblings()::childAt(0)"\n@init="dialog.opacitySlider = $component"\n></slider>\n</div>\n</layer-view>\n<div class="footer">\n<div class="fv__left-buttons">\n<checkbox \n@cannotBeDisabled\ntext="sidebar.layers.properties.locked"\n@on.change="dialog.toggleLock($component.getValue())"\nvisible="false"\nname="fv__ui-property-locked"\n></checkbox>\n</div>\n<xbutton\ntext="dialog.close"\nclass="fv__ui-dialog-button fv__ui-dialog-ok-button fv__ui-annot-property-close"\n@on.click="dialog.hide()"\n@cannotBeDisabled\nname="fv__ui-property-close"\n></xbutton>\n</div>\n</layer>\n'}},485:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},i=Object.create(r),o=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}i.$escape=function(e){return function(e){var t=""+e,n=o.exec(t);if(!n)return e;var r="",i=void 0,a=void 0,s=void 0;for(i=n.index,a=0;i<t.length;i++){switch(t.charCodeAt(i)){case 34:s="&#34;";break;case 38:s="&#38;";break;case 39:s="&#39;";break;case 60:s="&#60;";break;case 62:s="&#62;";break;default:continue}a!==i&&(r+=t.substring(a,i)),a=i+1,r+=s}return a!==i?r+t.substring(a,i):r}(a(e))},i.$each=function(e,t){if(Array.isArray(e))for(var n=0,r=e.length;n<r;n++)t(e[n],n);else for(var i in e)t(e[i],i)},e.exports=i},779:(e,t,n)=>{"use strict";e.exports=n(585)},616:t=>{"use strict";t.exports=e},732:e=>{"use strict";e.exports=t},290:e=>{"use strict";e.exports=n}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return r[e](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};return(()=>{"use strict";function e(t,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):e(t,n)}function t(t,n){if(!e(t,n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function s(e,t,n){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n||e):o.value}},s(e,t,n||e)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function u(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=i(e);if(t){var o=i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return u(this,n)}}o.d(a,{default:()=>Bt});var h=o(616),d=o(290);const f={print:4,modify:8,extract:16,annotForm:32,fillForm:256,extractAccess:512,assemble:1024,printHigh:2048};var v=d.Deps.jQuery,g=d.shared.browser.getPtPxRatio,m=d.Events,y=(d.shared.activation.ActivationGroup,d.commons.notImplemented),E=(d.PDF.engine.GraphicsObject,d.keyboard),_=E.BuiltinShortcutContext,b=E.BuiltinCommand,C=function(n){l(a,n);var o=p(a);function a(e,n,r){var i;return t(this,a),(i=o.call(this)).isDestroyed=!1,i.graphicsObject=e,i.pageRender=n,i.dependences=r,i}return r(a,[{key:"doActive",value:function(){var e=this.$handler,t=this.dependences.pdfViewer;if(!e){e=this.initUI(),this.$handler=e;var n=this.getContextMenuConfig();n&&!this.contextmenu&&(this.contextmenu=t.viewerUI.createContextMenu(this,e.get(0),n))}e.addClass("fwr__active"),this.updateShapeControl(),this.bindEvent()}},{key:"getContextMenuConfig",value:function(){}},{key:"getContextMenuComponentName",value:function(){y()}},{key:"removeGraphicObject",value:function(){this.remove()}},{key:"remove",value:function(){var e=this;if(this.isActive){this.removeToolbar&&this.removeToolbar();var t=this.dependences.pdfViewer;t.getAllActiveElements().forEach((function(t){t.unActive(),t!==e&&t.remove&&t.remove()})),0===t.getAllActiveElements().length&&t.activeElement()}}},{key:"removeGraphicObjects",value:function(e){for(var t=e.length-1;t>=0;t--){var n=e[t];if(n.removeToolbar&&n.removeToolbar(),n.unActive(),n.dependences.pdfViewer.unActiveElement(n),n.destroy(),!n.graphicsObject.doc.checkPermission(f.modify))throw new Error("Permission error");var r=0===t;n.graphicsObject.getPDFPage().removeGraphicsObjectEx(n.graphicsObject,r)}this.dependences.pdfViewer.activeElement()}},{key:"bindEvent",value:function(){var e=this,t=this.dependences.pdfViewer;t.getKeyboard().withContext(_.ACTIVATION_ANY,(function(n){e.isDestroyed||(e.__off__delete__event__=n.keydown(b.DELETE_SELECTED_OBJECT,(function(n){var r=t.getAllActiveElements();r.length>1?e===r[r.length-1]&&e.removeGraphicObjects(r):e.removeGraphicObject(),e.__off__delete__event__()})),e.__off__esc__event__=n.keydown(b.UNSELECT_OBJECT,(function(t){e.unActive(!0)})))}))}},{key:"unBindEvent",value:function(){this.__off__delete__event__&&this.__off__delete__event__(),this.__off__delete__event__=function(){},this.__off__esc__event__&&this.__off__esc__event__(),this.__off__esc__event__=function(){},this.__off_active_escape_event&&this.__off_active_escape_event(),delete this.__off_active_escape_event}},{key:"translateContextMenuName",value:function(e){for(var t in e)if("items"===t){var n=e[t],r=this.dependences.pdfViewer.i18n;for(var i in n){var o=n[i];o.nameI18nKey&&(o.name=r.t(o.nameI18nKey))}}return e}},{key:"updateShapeControl",value:function(){var e=this.getBoundary(),t=this._getShapeControllerBoundaryBox();this.shapeControl&&this.shapeControl.active(this.$handler,e,t)}},{key:"unActive",value:function(){this.isActive&&(s(i(a.prototype),"unActive",this).call(this),this.$handler&&(this.$handler.removeClass("fwr__active"),this.shapeControl&&this.shapeControl.deactive(),this.dependences.pdfViewer.eventEmitter.off(m.fitWidthResizeViewport,this.afterZoom),this.dependences.pdfViewer.eventEmitter.off(m.zoomToSuccess,this.afterZoom),this.$handler&&this.$handler.remove(),this.$handler=null,this.unBindEvent(),this.$charEditContainer&&this.$charEditContainer.off("focus"),this.removeToolbar&&this.removeToolbar()))}},{key:"doDeactive",value:function(){}},{key:"destroy",value:function(){this.isDestroyed=!0,this.unActive(),this.shapeControl&&this.shapeControl.destroy(),this.contextmenu&&this.contextmenu.destroy()}},{key:"getModel",value:function(){return this.graphicsObject}},{key:"_getShapeControllerBoundaryBox",value:function(){var e,t=this.pageRender.page,n=g()*this.pageRender.getScale(),r=[t.getPxWidth()*n,t.getPxHeight()*n],i=r[0],o=r[1];this.pageRender.rotate%180!=0&&(o=(e=[i,o])[0],i=e[1]);return{left:0,top:0,width:i,height:o}}},{key:"getBoundary",value:function(){var e=this.pageRender.page,t=this.graphicsObject.getRect(),n=e.getDeviceRect(t,this.pageRender.getScale(),this.pageRender.getRotation());return{left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top}}},{key:"initUI",value:function(){var e=this;if(!this.$handler){var t=this.$handler=v('<div class="fwr__graphics-object-handler"\n        ></div>');this.pageRender.pageHandler.$handler.append(t),t.get(0).__graphics_object_component=this;var n=!0;return this.predefineTextObject&&(n=!1),this.shapeControl=new d.ShapeControl({prestart:function(){return e.onPrestart()},start:function(t,n,r){return e.onStartUpdateShape(t,n,r)},moving:function(t,n,r){var i=r.offsetX,o=r.offsetY;return e.onShapeMoving(t,n,i,o)},update:function(t,n){return e.onShapeUpdating(t,n)},end:function(t,n,r,i){return e.onShapeUpdateEnd(t,n,r,i)},afterEnd:function(t){return e.onAfterShapeCtrlEnd(t)},resizable:n,enableDiagonally:!0,enableFrame:!0,previewer:!0,auxiliaryLine:void 0}),this.dependences.pdfViewer.eventEmitter.on(m.zoomToSuccess,this.afterZoom=function(){e.updateShapeControl()}),this.dependences.pdfViewer.eventEmitter.on(m.fitWidthResizeViewport,this.afterZoom),this.$handler}}},{key:"onPrestart",value:function(){var t=this;this.dependences.pdfViewer.getAllActiveElements().forEach((function(n){n!==t&&e(n,a)&&t.shapeControl.companion(n.shapeControl)}))}},{key:"onAfterShapeCtrlEnd",value:function(e){this.shapeControl.clearCompanions()}},{key:"onStartUpdateShape",value:function(e,t,n){var r=this;if("move"){if(this.dependences.pdfViewer.getAllActiveElements().length>1||!this.graphicsObject.getBitmap)return;v(this.shapeControl.ui.querySelector(".fv__shape-control-previewer")).show(),this.graphicsObject.getBitmap(this.pageRender.getScale(),this.pageRender.getRotation()).then((function(e){if(e){var t=r.shapeControl.getPreviewerContext();v(t.canvas).attr({width:e.width,height:e.height});var n=t.createImageData(e.width,e.height+1),i=new(Uint8ClampedArray||Uint8Array)(e.buffer);n.data.set(i),t.putImageData(n,0,0)}}))}}},{key:"onShapeMoving",value:function(e,t){}},{key:"onShapeUpdating",value:function(e,t){}},{key:"onShapeUpdateEnd",value:function(e,t,n){var r=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=Object.assign({},e);o.right=o.left+o.width,o.bottom=o.top+o.height,o=this.pageRender.page.reverseDeviceRect(o,this.pageRender.getScale(),this.pageRender.getRotation()),this.graphicsObject.setRect(o,i).then((function(e){v(r.shapeControl.ui.querySelector(".fv__shape-control-previewer")).hide(),r.updateShapeControl()}))}},{key:"setColor",value:function(e){return this.graphicsObject.setBorderColor(e)}},{key:"setBorderStyle",value:function(e,t){var n=this;return this.graphicsObject.setBorderStyle(e,t).then((function(e){n.updateShapeControl()}))}},{key:"setOpacity",value:function(e){return this.graphicsObject.setOpacity(e)}},{key:"setFillColor",value:function(e){return this.graphicsObject.setFillColor(e)}},{key:"setBorderWidth",value:function(e){var t=this;return this.graphicsObject.setBorderWidth(e).then((function(e){t.updateShapeControl()}))}},{key:"moveToPosition",value:function(e,t){var n=this;return this.graphicsObject.moveToPosition(e,t).then((function(e){n.updateShapeControl()}))}},{key:"getGraphicsObject",value:function(){return this.graphicsObject}}]),a}(d.shared.activation.Activatable);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const x={textObjectActive:"text-object-active",textObjectUnActive:"text-object-unactive",addTextObjectParamTransfer:"add-text-object-param-transfer"};var w,k={};"function"==typeof FontFace?w=function(e,t){return k[e]?k[e]:k[e]=new Promise((function(n,r){t().then((function(t){if(!t)return r(),void k[e];var i=new FontFace(e,t.buffer||t.url);i.load().then((function(){document.fonts.add(i),n(i)}),(function(){r(),delete k[e]}))}),(function(){r(),delete k[e]}))}))}:w=function(e,t){return k[e]?k[e]:k[e]=new Promise((function(n,r){t().then((function(t){return t?t.buffer?URL.createObjectURL(new Blob([t.buffer],"application/x-font-woff")):t.url:(r("woff is invalid"),void delete k[e])})).then((function(t){if(!t)return r();var i=document.createElement("style");i.innerHTML='@font-face{font-family:"'+e+'"; src:url("'+t+'");}',document.head.appendChild(i),n(i)}))}))};var P;!function(e){e.STATE_HANDLER_HAND="hand",e.STATE_HANDLER_CHECK_THE_SEARCH="checkTheSearch",e.STATE_HANDLER_CREATE_CARET="createCaret",e.STATE_HANDLER_CREATE_ARROW="createArrow",e.STATE_HANDLER_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CIRCLE="createCircle",e.STATE_HANDLER_CREATE_FILE_ATTACHMENT="createFileAttachment",e.STATE_HANDLER_CREATE_HIGHLIGHT="createHighlight",e.STATE_HANDLER_CREATE_IMAGE="createImage",e.STATE_HANDLER_CREATE_LINK="createLink",e.STATE_HANDLER_CREATE_LINE="createLine",e.STATE_HANDLER_CREATE_DISTANCE="createDistance",e.STATE_HANDLER_CREATE_PERIMETER="createPerimeter",e.STATE_HANDLER_CREATE_AREA="createArea",e.STATE_HANDLER_CREATE_CIRCLE_AREA="createCircleArea",e.STATE_HANDLER_CREATE_PENCIL="createPencil",e.STATE_HANDLER_CREATE_POLYGON_CLOUD="createPolygonCloud",e.STATE_HANDLER_CREATE_POLYGON="createPolygon",e.STATE_HANDLER_CREATE_POLYLINE="createPolyline",e.STATE_HANDLER_CREATE_REPLACE="createReplace",e.STATE_HANDLER_CREATE_SQUARE="createSquare",e.STATE_HANDLER_CREATE_SQUIGGLY="createSquiggly",e.STATE_HANDLER_CREATE_STAMP="createStamp",e.STATE_HANDLER_CREATE_STRIKE_OUT="createStrikeOut",e.STATE_HANDLER_CREATE_TEXT="createText",e.STATE_HANDLER_CREATE_UNDERLINE="createUnderline",e.STATE_HANDLER_MARQUEE="marquee",e.STATE_HANDLER_ERASER="eraser",e.STATE_HANDLER_LOUPE="loupe",e.STATE_HANDLER_SELECT_TEXT_ANNOTATION="select-text-annotation",e.STATE_HANDLER_SELECT_TEXT_IMAGE="select-text-image",e.STATE_HANDLER_SELECT_ANNOTATION="select-annotation",e.STATE_HANDLER_CREATE_FREETEXT_BOX="createFreeTextBox",e.STATE_HANDLER_CREATE_FREETEXT_CALLOUT="createFreeTextCallout",e.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER="createFreeTextTypewriter",e.STATE_HANDLER_CREATE_FIELD_TEXT="CreateTextStateHandler",e.STATE_HANDLER_CREATE_FIELD_SIGNATURE="CreateSignStateHandler",e.STATE_HANDLER_CREATE_FIELD_PUSH_BUTTON="CreatePushButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_CHECK_BOX="CreateCheckBoxStateHandler",e.STATE_HANDLER_CREATE_RADIO_BUTTON="CreateRadioButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_COMBO_BOX="CreateComboBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_LIST_BOX="CreateListBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_DATE="CreateDateStateHandler",e.STATE_HANDLER_CREATE_FIELD_IMAGE="CreateImageStateHandler",e.STATE_HANDLER_SNAPSHOT_TOOL="snapshot-tool",e.STATE_HANDLER_CREATE_DOCUMENT_ATTACHMENT="createDocumentAttachment"}(P||(P={}));var D,H=P.STATE_HANDLER_HAND,O=(P.STATE_HANDLER_CHECK_THE_SEARCH,P.STATE_HANDLER_CREATE_CARET),I=P.STATE_HANDLER_CREATE_ARROW,j=P.STATE_HANDLER_CREATE_AREA_HIGHLIGHT,L=(P.STATE_HANDLER_CREATE_AREA_HIGHLIGHT,P.STATE_HANDLER_CREATE_CIRCLE),N=P.STATE_HANDLER_CREATE_FILE_ATTACHMENT,B=P.STATE_HANDLER_CREATE_HIGHLIGHT,F=P.STATE_HANDLER_CREATE_IMAGE,$=P.STATE_HANDLER_CREATE_LINK,U=P.STATE_HANDLER_CREATE_LINE,M=P.STATE_HANDLER_CREATE_DISTANCE,V=P.STATE_HANDLER_CREATE_PERIMETER,G=P.STATE_HANDLER_CREATE_AREA,W=P.STATE_HANDLER_CREATE_CIRCLE_AREA,X=P.STATE_HANDLER_CREATE_PENCIL,Y=P.STATE_HANDLER_CREATE_POLYGON_CLOUD,K=P.STATE_HANDLER_CREATE_POLYGON,z=P.STATE_HANDLER_CREATE_POLYLINE,q=P.STATE_HANDLER_CREATE_REPLACE,Q=P.STATE_HANDLER_CREATE_SQUARE,J=P.STATE_HANDLER_CREATE_SQUIGGLY,Z=P.STATE_HANDLER_CREATE_STAMP,ee=P.STATE_HANDLER_CREATE_STRIKE_OUT,te=P.STATE_HANDLER_CREATE_TEXT,ne=P.STATE_HANDLER_CREATE_UNDERLINE,re=(P.STATE_HANDLER_MARQUEE,P.STATE_HANDLER_ERASER,P.STATE_HANDLER_LOUPE,P.STATE_HANDLER_SELECT_TEXT_ANNOTATION,P.STATE_HANDLER_SELECT_TEXT_IMAGE,P.STATE_HANDLER_SELECT_ANNOTATION,P.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER),ie=P.STATE_HANDLER_CREATE_FREETEXT_CALLOUT,oe=P.STATE_HANDLER_CREATE_FREETEXT_BOX,ae=(P.STATE_HANDLER_SNAPSHOT_TOOL,P.STATE_HANDLER_CREATE_DOCUMENT_ATTACHMENT,P.STATE_HANDLER_CREATE_FIELD_TEXT,P.STATE_HANDLER_CREATE_FIELD_SIGNATURE,P.STATE_HANDLER_CREATE_FIELD_PUSH_BUTTON,P.STATE_HANDLER_CREATE_RADIO_BUTTON,T(D={},te,"text"),T(D,B,"highlight"),T(D,ee,"strikeout"),T(D,ne,"underline"),T(D,J,"squiggly"),T(D,q,"strikeout"),T(D,O,"caret"),T(D,re,"freetext"),T(D,ie,"freetext"),T(D,oe,"freetext"),T(D,Q,"square"),T(D,L,"circle"),T(D,U,"line"),T(D,I,"line"),T(D,K,"polygon"),T(D,z,"polyline"),T(D,Y,"polygon"),T(D,j,"highlight"),T(D,X,"ink"),T(D,Z,"stamp"),T(D,M,"line"),T(D,V,"polyline"),T(D,G,"polygon"),T(D,W,"circle"),T(D,N,"fileattachment"),T(D,F,"screen"),T(D,$,"link"),T(D,"create-multi-media-state","screen"),T(D,"create-redaction-text-image-state","redact"),T(D,"create-redaction-state","redact"),o(732)),se=d.Deps.jQuery,ce=d.shared.browser.getPtPxRatio,le=d.ViewerEvents.renderPageSuccess,ue=d.ViewerEvents.switchStateHandler,pe=d.keyboard,he=pe.BuiltinCommand,de=pe.BuiltinShortcutContext,fe=d.shared.debounce,ve=d.commons,ge=ve.colorConvertor,me=(ve.KeyCodes,ve.KeyboardUtils),ye=(me.isMatch,me.matchers,function(e){l(o,e);var n=p(o);function o(e,r,i){var a;return t(this,o),(a=n.call(this,e,r,i)).fillSign=!1,a}return r(o,[{key:"initUI",value:function(){var e=this,t=this.$handler=se('<div class="fwr__graphics-object-handler fwr__text-object-edit"\n        ></div>');this.pageRender.pageHandler.$handler.after(t),t.get(0).__graphics_object_component=this;this.shapeControl=new d.ShapeControl({prestart:function(){return e.onPrestart()},start:function(t,n,r){return e.onStartUpdateShape(t,n,r)},moving:function(t,n,r){var i=r.offsetX,o=r.offsetY;return e.onShapeMoving(t,n,i,o)},update:function(t,n){return e.onShapeUpdating(t,n)},rotate:function(t,n){return e.onRotate(t,n)},end:function(t,n,r,i){return e.onShapeUpdateEnd(t,n,r,i)},afterEnd:function(t){return e.onAfterShapeCtrlEnd(t)},resizable:!0,enableDiagonally:!0,enableFrame:!0,previewer:!0});return t.on("dblclick",(function(){e.unActive(),e.activeCharEdit()})),this.$handler}},{key:"reActive",value:function(){}},{key:"active",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];s(i(o.prototype),"active",this).call(this),this.reActive=function(){e.unActive(),e.active()};var n=this.pageRender.pdfViewer.getEventEmitter();t&&n.emit(x.textObjectActive,this),this.pageRedrawBind&&n.off(le,this.pageRedrawBind),n.on(le,this.pageRedrawBind=function(t){t.index===e.getModel().getPDFPage().getIndex()&&e.reActive()}),n.on(ue,this.switchStateHandlerBind=function(){e.eCharInput&&e.applyEdit()})}},{key:"unActive",value:function(){this.dependences.pdfViewer._setSaveBefore(),s(i(o.prototype),"unActive",this).call(this),this.unActiveCharEdit();var e=this.pageRender.pdfViewer.getEventEmitter();e.off(le,this.pageRedrawBind),e.off(ue,this.switchStateHandlerBind),e.emit(x.textObjectUnActive,this)}},{key:"unActiveCharEdit",value:function(){this.$charEditContainer&&this.$charEditContainer.remove(),this.$charEditContainer=null,this.unswitchBinder&&this.unswitchBinder()}},{key:"applyEdit",value:function(){var e=this;if(!this.eCharInput)return Promise.reject(new Error("text input box has not been initialized!"));var t=this.eCharInput.innerText;"string"!=typeof t&&(t=this.eCharInput.textContent);for(var n="",r=0,i=0;i<t.length;i++){this.eCharInput.innerText=t.substring(0,i+1);for(var o=t[i];("\n"==o||"\r"==o)&&i<t.length;)o=t[++i];var a=this.eCharInput.offsetHeight;void 0!==o&&(n+=0!==r&&r<a?"\n"+o:o),r=a}return t=n.replace(/\u00a0/g," "),this.isApplyEdit=!0,this.setTextChar(t).then((function(){e.unActive()})).finally((function(){e.isApplyEdit=!1}))}},{key:"initCharEditContainer",value:function(){var e,t=this;e=this.fillSign?se('<div class="fv__text-object-edit-char-container"><div class="fv__text-object-edit-char-mask-layer"></div><div><span class="fv_fillsign-moving"></span><span class="fv__text-object-edit-char-input " contenteditable></span></div></div>'):se('<div class="fv__text-object-edit-char-container"><div class="fv__text-object-edit-char-mask-layer"></div><span class="fv__text-object-edit-char-input " contenteditable></span></div>'),this.pageRender.$handler.after(e);var n=e.find(".fv__text-object-edit-char-input"),r=n[0];return this.eCharInput=r,n.on("keydown",(function(r){if(!r.shiftKey&&(13===r.keyCode&&(r.preventDefault(),t.applyEdit()),t.fillSign)){var i=e.find(".fv__text-object-edit-char-mask-layer"),o=n[0].getBoundingClientRect().width;i.width()<o+15&&i.css("width",o+15+"px")}})),this.fillSign&&this.bindMovingEvent(e),e}},{key:"activeCharEdit",value:function(e){var t=this;this.isActive=!0;var n=this.$charEditContainer=this.$charEditContainer||this.initCharEditContainer(),r=n.find(".fv__text-object-edit-char-mask-layer"),i=n.find(".fv__text-object-edit-char-input");this.dependences.pdfViewer._setSaveBefore((function(){return t.applyEdit()}));var o=this.graphicsObject,a=o.getRect(),s=this.pageRender,c=s.pdfViewer;return i.off("focus").on("focus",(function(){var e,n=c.getKeyboard(),r=n.activeContext(de.EDIT_TEXT_OBJECT),i=!1;n.withContext(de.EDIT_TEXT_OBJECT,(function(n){i||(e=n.keyup(he.BLUR_EDITTING_TEXT_OBJECT,(function(){var e=t.eCharInput.innerText;"string"!=typeof e&&(e=t.eCharInput.textContent),t.setTextChar(e).then((function(){t.unActive()})),c.getStateHandlerManager().switchTo(H)})))})),t.unswitchBinder=function(){i||(i=!0,r(),e&&e())}})),c.getEventEmitter().on(ue,this.switchStateHandlerBind=function(){t.eCharInput&&t.applyEdit()}),Promise.all([s.getPDFPage(),s.getScale(),s.getRotation()]).then((function(e){var t=R(e,3),n=t[0],r=t[1],i=t[2];return[n.getDeviceRect(a,r,i),n,r,i]})).then((function(i){var a=R(i,4),c=a[0],l=a[1],u=a[2],p=a[3],h=function(){var e=s.$ui[0].getBoundingClientRect(),t=v.getBoundingClientRect();return{maxWidth:e.right-t.left,maxHeight:e.bottom-t.top}};n.css({left:c.left+"px",top:c.bottom+"px"});var f=n.find(".fv__text-object-edit-char-input"),v=f[0];r.css({width:c.right-c.left+"px",height:c.bottom-c.top+"px"});var g=o.getText();g=g.replace(/\u0020/g,"Â "),void 0===e&&(e=g),"string"==typeof v.innerText?v.innerText=g:v.textContent=g;var m=o.getFontSize(),y=o.getMatrix().toArray().slice(0,4),E=12,_=m*ce()<E;_&&(m*=E,y[0]/=E,y[1]/=E,y[2]/=E,y[3]/=E),y[0]*=u,y[1]*=-u,y[2]*=-u,y[3]*=u;var b=new d.Matrix(y[0],y[1],y[2],y[3],0,0),C=l.getRotationAngle()+p;if(b.rotate(C/180*Math.PI),t.fillSign)f.css(T({fontSize:m+"pt",transform:"matrix("+b.toArray().join(",")+")",color:ge(16777215&o.getFillColor(),"#")},"transform","matrix("+b.toArray().join(",")+")"));else{if("TimesNewRoman"===o.info.textState.font.baseName)otherFontName="Times New Roman";f.css({fontFamily:'"'+[o.info.textState.font.baseName,o.info.textState.font.familyName,o.info.textState.font.nameKey,o.info.textState.font.name,"FoxitPDFSDKForWeb"].join('","')+'"',fontSize:m+"pt",fontWeight:o.info.textState.font.isBold?700:400,fontStyle:o.info.textState.font.isItalic?"italic":"",transform:"matrix("+b.toArray().join(",")+")",color:ge(16777215&o.getFillColor(),"#")})}var A,S,k=f.height(),P=f.width(),D=b.transformPoint(P,k),H=D[0],O=D[1];t.fillSign&&t.showToolbar(Math.abs(O)),H>=0&&O>0?(A=-b.transformPoint(P,0)[1]-k,S=0):H<0&&O>=0?(A=-b.transformPoint(P,0)[1]-k,S=-b.transformPoint(0,P)[1]):H<=0&&O<0?(A=b.transformPoint(0,k)[1]-k,S=-H+b.transformPoint(0,k)[0]):H>0&&O<=0&&(A=-b.transformPoint(0,k)[1]-k,S=H-b.transformPoint(P,0)[0]),f.css({top:A+"px",left:S+"px",transformOrigin:"left "+k+"px",bottom:"auto"}),e!==g&&("string"==typeof v.innerText?v.innerText=e:v.textContent=e),t.fillSign||w(o.info.textState.font.nameKey||o.info.textState.font.name,o.getWoff.bind(o)).catch((function(){})),t.reActive=function(e){t.unActive(),t.activeCharEdit(e)};var I=t.pageRender.pdfViewer.getEventEmitter();t.fillSign||I.emit(x.textObjectActive,t),document.activeElement!==v&&v.focus();var j=h(),L=j.maxWidth,N=j.maxHeight,B=_?u/E:u;v.style.cssText+="\n                max-width: ".concat(L/B,"px;\n            ");var F=v.textContent,$=function(){v.style.cssText+="\n                    white-space: pre;\n                    width: auto;\n                ";var e=v.getBoundingClientRect().width;v.style.cssText+="\n                    width: ".concat(Math.min(L,e)/B,"px;\n                    white-space: pre-line;\n                ");var t=(0,ae.getCursorPositionOfEditableElement)(v);v.getBoundingClientRect().height>N?(v.textContent=F,(0,ae.moveCursorTo)(v,t)):F=v.textContent},U=!1;v.addEventListener("input",(function(){U||$()})),v.addEventListener("compositionstart",(function(){U=!0,v.style.maxWidth=L/u+"px"}));var M=fe($,0);v.addEventListener("compositionupdate",(function(){M()})),v.addEventListener("compositionend",(function(){U=!1,v.style.maxWidth="",$()})),t.pageRedrawBind&&I.off(le,t.pageRedrawBind),I.on(le,t.pageRedrawBind=function(n){if(n.index===t.getModel().getPDFPage().getIndex()){e="string"==typeof v.innerText?v.innerText:v.textContent;var r=h(),i=r.maxWidth,o=r.maxHeight;L=i,N=o;var a=_?n.scale/E:n.scale;v.style.cssText+="\n                        max-width: ".concat(L/a,"px;\n                    ")}})}))}},{key:"showToolbar",value:function(e){}},{key:"setTextChar",value:function(e){return this.graphicsObject.setText(e)}},{key:"getContextMenuConfig",value:function(){}},{key:"getTextChar",value:function(){if(this.$charEditContainer){var e=this.$charEditContainer.find(".fv__text-object-edit-char-input")[0],t=e.innerText;return"string"!=typeof t&&(t=e.textContent),t.replace(/\u00a0/g," ")}return this.getModel().getText()}},{key:"textCharSure",value:function(){return!this.isApplyEdit&&this.$charEditContainer?this.fillSign?this.saveFillSign():this.applyEdit():Promise.resolve()}},{key:"remove",value:function(){return s(i(o.prototype),"remove",this).call(this),this.dependences.pdfViewer.unActiveElement(this),this.destroy(),this.graphicsObject.remove()}}]),o}(C));function Ee(e){if("clientX"in e)return e.clientX;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientX;case"touchend":case"touchcancel":return e.changedTouches[0].clientX}}function _e(e){if("clientY"in e)return e.clientY;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientY;case"touchend":case"touchcancel":return e.changedTouches[0].clientY}}var be=d.Deps.jQuery,Ce=d.commons.colorConvertor,Te=function(e){l(o,e);var n=p(o);function o(e,r,i){return t(this,o),n.call(this,e,r,i)}return r(o,[{key:"active",value:function(){s(i(o.prototype),"active",this).call(this)}},{key:"getPropertyOptions",value:function(){var e=this.graphicsObject,t=e.getBorderColor();t=this.graphicsObject.needStroke()?Ce(t||4278190080,"#"):0;var n=e.getFillColor();0==e.getFillMode()&&(n=0);var r=e.getBorderWidth();return{color:t,borderTransparent:!0,opacity:e.getOpacity(),fillColor:n,borderWidth:r}}},{key:"initUI",value:function(){var e=this;s(i(o.prototype),"initUI",this).call(this),this.$tip=be('<div class="fwr__path-object-tip"></div>'),this.$tip.appendTo(this.$handler);var t=this.rectHammer=new Hammer.Manager(this.$handler[0],{recognizers:[[Hammer.Press]]});return this.$handler.on("mousemove",(function(t){e.$tip.hide()})),t.on("press",(function(t){if(!be(".fv__ui-mobile").length){var n=e.graphicsObject.getRect(),r=Ae(e.$handler.parent()[0],t),i={left:r.x+"px",top:r.y+20+"px"};r=e.pageRender.page.reverseDevicePoint([r.x,r.y],e.pageRender.getScale(),e.pageRender.getRotation()),e.$tip.show().css(i).html("object : x:".concat(n.left.toFixed(2),",y:").concat(n.bottom.toFixed(2))+"<br/>mouse: x:".concat(r[0].toFixed(2),",y:").concat(r[1].toFixed(2)))}})),this.$handler}},{key:"showPropertiesDialog",value:function(e){var t=this.dependences.pdfViewer.activePropertiesDialog;this.dependences.pdfViewer.activePropertiesDialog?(t.show(e),t.setViewerComponent(this),this.activePropertiesDialog=t):this.propertiesControl=new d.PropertiesControl(this)}},{key:"getContextMenuComponentName",value:function(){return"fv--path-graphics-object-contextmenu"}},{key:"getContextMenuConfig",value:function(){var e=this;return{selector:"div.fv__shape-control",items:{properties:{name:"properties",nameI18nKey:"viewer_:contextmenu.annot.properties",callback:function(t,n,r){e.showPropertiesDialog(r)}},remove:{name:"delete",nameI18nKey:"viewer_:contextmenu.annot.delete",callback:function(){e.remove()}}}}}},{key:"unActive",value:function(e){var t=this.activePropertiesDialog;t&&t.viewerComponent===this&&t.hide(),s(i(o.prototype),"unActive",this).call(this,e)}},{key:"remove",value:function(){return s(i(o.prototype),"remove",this).call(this),this.dependences.pdfViewer.unActiveElement(this),this.destroy(),this.graphicsObject.remove()}},{key:"destroy",value:function(){this.contextmenu&&this.contextmenu.destroy(),this.propertiesControl&&this.propertiesControl.close(),this.propertiesControl=null,this.rectHammer&&this.rectHammer.destroy(),s(i(o.prototype),"destroy",this).call(this)}}]),o}(C),Ae=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,i=Ee(r),o=_e(r);return{x:i-n.left-t.deltaX,y:o-n.top-t.deltaY}},Se=d.Deps.jQuery,Re=d.Events,xe=function(e){l(o,e);var n=p(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"_resize",value:function(e,t,n){this.enableUniform="north"!=e&&"south"!=e&&"east"!=e&&"west"!=e,s(i(o.prototype),"_resize",this).call(this,e,t,n)}}]),o}(d.ShapeControl),we=function(n){l(a,n);var o=p(a);function a(e,n,r){return t(this,a),o.call(this,e,n,r)}return r(a,[{key:"initUI",value:function(){var e=this,t=this,n=this.$handler=Se('<div class="fwr__graphics-object-handler" \n        ></div>');return this.pageRender.pageHandler.$handler.append(n),n.get(0).__graphics_object_component=this,this.shapeControl=new xe({prestart:function(){return e.onPrestart()},start:function(t,n,r){return e.onStartUpdateShape(t,n,r)},moving:function(t,n,r){var i=r.offsetX,o=r.offsetY;return e.onShapeMoving(t,n,i,o)},update:function(t,n){return e.onShapeUpdating(t,n)},beforeRotateStart:function(){return e.onBeforeRotateStart()},rotateEnd:function(t,n,r,i){return e.onRotate(t)},afterRotateEnd:function(){return e.onAfterRotateEnd()},rotateStart:function(){return e.onRotateStart()},end:function(t,n,r,i){return e.onShapeUpdateEnd(t,n,r,i)},afterEnd:function(t){return e.onAfterShapeCtrlEnd(t)},resizable:!0,rotatable:!0,enableDiagonally:!0,enableFrame:!0,enableUniform:!0,previewer:!0,enableSizeBox:!0}),this.dependences.pdfViewer.eventEmitter.on(Re.zoomToSuccess,this.afterZoom=function(){t.updateShapeControl()}),this.$handler}},{key:"onBeforeRotateStart",value:function(){var t=this;this.dependences.pdfViewer.getAllActiveElements().forEach((function(n){n!==t&&e(n,a)&&t.shapeControl.companion(n.shapeControl)}))}},{key:"onAfterRotateEnd",value:function(){this.shapeControl.rotateDegree=0,this.shapeControl.companions.forEach((function(e){return e.rotateDegree=0})),this.shapeControl.clearCompanions()}},{key:"onRotate",value:function(e){var t=this;return this.pageRender.$handler.get(0).classList.remove("fv__cursor-rotation"),this.graphicsObject.setRotation(e).then((function(e){t.updateShapeControl()}))}},{key:"updateShapeControl",value:function(){s(i(a.prototype),"updateShapeControl",this).call(this),this.shapeControl.ui.style.transform=""}},{key:"onRotateStart",value:function(){this.pageRender.$handler.get(0).classList.add("fv__cursor-rotation")}},{key:"getContextMenuConfig",value:function(){var e=this;return{selector:"div.fv__shape-control",items:{properties:{name:"properties",nameI18nKey:"viewer_:contextmenu.annot.properties",callback:function(t,n,r){e.showPropertiesDialog(r)}},remove:{name:"delete",nameI18nKey:"viewer_:contextmenu.annot.delete",callback:function(){var t=e.dependences.pdfViewer;if(t.getAllActiveElements().forEach((function(e){e.remove&&e.remove()})),0===t.getAllActiveElements().length){var n=t.getCurrentActivatable();n&&t.unActiveElement(n)}}}}}}},{key:"getContextMenuComponentName",value:function(){return"fv--image-graphics-object-contextmenu"}},{key:"getPropertyOptions",value:function(){return{opacity:this.graphicsObject.getOpacity(),borderStyle:!1}}},{key:"showPropertiesDialog",value:function(e){var t=this.dependences.pdfViewer.activePropertiesDialog;this.dependences.pdfViewer.activePropertiesDialog?(t.show(e),t.setViewerComponent(this),this.activePropertiesDialog=t):this.$propertiesControl=new d.PropertiesControl(this)}},{key:"hidePropertiesDialog",value:function(){this.$propertiesControl&&this.$propertiesControl.close()}},{key:"destroy",value:function(){this.contextmenu&&this.contextmenu.destroy(),this.dependences.pdfViewer.eventEmitter.off(Re.zoomToSuccess,this.afterZoom),s(i(a.prototype),"destroy",this).call(this)}},{key:"setOpacity",value:function(e){this.graphicsObject.setOpacity(e)}},{key:"remove",value:function(){s(i(a.prototype),"remove",this).call(this),this.graphicsObject.remove(),this.dependences.pdfViewer.unActiveElement(this),this.destroy()}},{key:"unActive",value:function(e){var t=this.activePropertiesDialog;t&&t.viewerComponent===this&&t.hide(),s(i(a.prototype),"unActive",this).call(this,e)}}]),a}(C),ke=(function(e){l(i,e);var n=p(i);function i(e,r,o){return t(this,i),n.call(this,e,r,o)}r(i,[{key:"active",value:function(){}},{key:"getContextMenuConfig",value:function(){}}])}(C),function(){function e(){t(this,e),this.matchRules=[]}return r(e,[{key:"registerMatchRule",value:function(e){return this.matchRules.push(e),e}},{key:"unRegisterMatchRule",value:function(e){var t=this.matchRules.indexOf(e);-1!==t&&this.matchRules.splice(t,1)}},{key:"get",value:function(e){for(var t=this.matchRules,n=this.getDefault(e),r=t.length;r--;){var i=t[r];if("function"==typeof i){var o=i(e,n);if(o)return o}}return n}},{key:"getDefault",value:function(e){switch(e.getType()){case 1:return ye;case 2:return Te;case 3:return we;default:return C}}}]),e}()),Pe=d.Deps.Hammer;function De(e,n){var i=e.graphicsManager,o=["","text","path","image","shading","all"][n],a=o?["fv__edit-",o,"-state-handler"].join(""):"";return a+=" fv__edit-graphics-state-handler",function(s){l(u,s);var c=p(u);function u(e){return t(this,u),c.call(this,e)}return r(u,[{key:"pageHandler",value:function(t){var r=this;this.pageRender=t;var o=t.getPDFPage(),s=t.$handler,c=s[0];s.addClass(a),(this.hammer=new Pe(c)).on("tap",(function(a){if(-1!=a.target.className.indexOf("fv__shape-control-move-area"))return Promise.resolve();r.resetHandler();var s=He(c,a);o.then((function(e){return[e,e.reverseDevicePoint([s.x,s.y],t.getScale(),t.getRotation())]})).then((function(e){var t=R(e,2),r=t[0],i=R(t[1],2),o=i[0],a=i[1];return 5===n?r.getGraphicsObjectAtPoint([o,a],5,0):r.getGraphicsObjectAtPoint([o,a],3,n)})).then((function(e){return!e||e.type<1||e.type>3?Promise.reject():[i.get(e),e]})).then((function(n){var r=R(n,2);return new(0,r[0])(r[1],t,e)})).then((function(e){return r.currentComponent=e,e.active()})).catch((function(e){e&&console.error(e),r.currentComponent=null,r.pdfViewer.activeElement()}))}))}},{key:"destroyPageHandler",value:function(){this.unregisterKeyEvent&&this.unregisterKeyEvent(),this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(a),this.resetHandler()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.currentComponent&&(this.currentComponent.textCharSure&&this.currentComponent.textCharSure(),this.currentComponent.unActive())}}],[{key:"getStateName",value:function(){return"edit-"+o}}]),u}(d.IStateHandler)}var He=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,i=Ee(r),o=_e(r);return{x:i-n.left-t.deltaX,y:o-n.top-t.deltaY}},Oe=d.Deps.Hammer;function Ie(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var je=function(){function e(){t(this,e)}return r(e,null,[{key:"pointsToRect",value:function(e,t,n){var r=e.x>t.x?t.x:e.x,i=e.x<t.x?t.x:e.x,o=e.y>t.y?t.y:e.y,a=e.y<t.y?t.y:e.y;if(n){var s=o;(o=a)-(a=s)<1&&(o=a+1,a-=1)}else a-o<1&&(a=o+1,o-=1);return i-r<1&&(i=r+1,r-=1),{left:r-2,top:a+1,right:i+2,bottom:o-1}}},{key:"generatePoints",value:function(t,n,r){var i=t.x,o=t.y,a=n.x-i,s=n.y-o;switch(r){case"line":return e.genLinePoints(i,o,a,s);case"square":return e.genSquarePoints(i,o,a,s);case"circle":return e.genOvalPoints(i,o,a,s);case"roundRect":return e.genRoundRectPoints(i,o,a,s)}}},{key:"genLinePoints",value:function(e,t,n,r){var i=[];return i.push(["m",e,t]),i.push(["l",e+n,t+r]),i}},{key:"genOvalPoints",value:function(e,t,n,r){var i=[];return i.push(["m",e+n/2,t]),(i=(i=(i=(i=i.concat(Le(e+n/2,t,n/2,r/2,1))).concat(Le(e+n,t+r/2,-n/2,r/2,0))).concat(Le(e+n/2,t+r,-n/2,-r/2,1))).concat(Le(e,t+r/2,n/2,-r/2,0))).push(["h",i[0][1],i[0][2]]),i}},{key:"genRoundRectPoints",value:function(e,t,n,r){var i=[],o=.2*n,a=.2*r,s=.8*n,c=.8*r;return i.push(["m",e+o,t]),i.push(["l",e+s,t]),(i=i.concat(Le(e+s,t,o,a,1))).push(["l",e+n,t+c]),(i=i.concat(Le(e+n,t+c,-o,a,0))).push(["l",e+o,t+r]),(i=i.concat(Le(e+o,t+r,-o,-a,1))).push(["l",e,t+a]),(i=i.concat(Le(e,t+a,o,-a,0))).push(["l",i[0][1],i[0][2]]),i.push(["h"]),i}},{key:"genSquarePoints",value:function(e,t,n,r){var i=[];return i.push(["m",e,t]),i.push(["l",e+n,t]),i.push(["l",e+n,t+r]),i.push(["l",e,t+r]),i.push(["h",e,t]),i}}]),e}();function Le(e,t,n,r,i){var o=[],a=.5522847498308;return i?(o.push(["c",e+a*n,t]),o.push(["c",e+n,t+a*r]),o.push(["c",e+n,t+r])):(o.push(["c",e,t+a*r]),o.push(["c",e+a*n,t+r]),o.push(["c",e+n,t+r])),o}var Ne=d.Deps.jQuery,Be=d.Deps.Hammer,Fe=d.IStateHandler,$e=function e(){t(this,e),this.addon=null,this.pathType=0,this.canAdd=!1},Ue=function(e){l(i,e);var n=p(i);function i(e){var r;return t(this,i),(r=n.call(this,e)).destroyHooks=[],r}return r(i,[{key:"addDestroyHook",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;(r=this.destroyHooks).push.apply(r,Ie(t))}},{key:"addEventTo",value:function(e,t,n){return e.on(t,n),function(){e.off(t,n)}}},{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n,r,i=e.pdfViewer.getIoC().getInstanceByClass($e),o=e.$handler;o.addClass("fv__create-callout-state-handler "+this.cursorStyle),this.shapeDom=(0==(r=(n=o).find(".fv__add-path-preview")).length&&(r=Ne('<canvas class="fv__add-path-preview" style="position: absolute;display:none"></canvas>'),n.append(r)),r);var a,s,c=o[0],l=this.hammer=new Be.Manager(c,{recognizers:[[Be.Pan,{direction:Be.DIRECTION_ALL}]]}),u=function(e){i.canAdd=-1!=e.target.className.indexOf("fv__pdf-page-handler-container")};this.addDestroyHook(this.addEventTo(o,"mousedown",u),this.addEventTo(o,"touchstart",u),(function(){l.destroy()})),l.on("panstart",(function(e){i.canAdd&&(a=Me(c,e))})).on("panend",(function(n){if(a){s={x:a.x+n.deltaX,y:a.y+n.deltaY};var r=t.pageRender.page.reverseDevicePoint([a.x,a.y],t.pageRender.getScale(),t.pageRender.getRotation()),o=t.pageRender.page.reverseDevicePoint([s.x,s.y],t.pageRender.getScale(),t.pageRender.getRotation()),c={x:r[0],y:r[1]},l={x:o[0],y:o[1]},u=je.generatePoints(c,l,i.pathType),p=je.pointsToRect(c,l);t.pageRender.page.addGraphicsObject({type:2,points:u,rect:p}).then((function(e){return a=null,t.shapeDom.hide(),e})).then((function(e){return e?[i.addon.graphicsManager.get(e),e]:Promise.reject(new Error("Graphics object was not created!"))})).then((function(t){var n=R(t,2);return new(0,n[0])(n[1],e,i.addon)})).then((function(e){t.currentComponet=e,t.pdfViewer.activeElement(e)})).catch((function(e){throw t.currentComponet=null,t.pdfViewer.activeElement(),e}))}})).on("panmove",(function(e){if(a){s={x:a.x+e.deltaX,y:a.y+e.deltaY};var n=je.pointsToRect(a,s,!0);!function(e,t,n){var r=n[0],i=r.getContext("2d");i.clearRect(0,0,n.width(),n.height()),r.width=t.right-t.left+4,r.height=t.bottom-t.top+4,i.clearRect(0,0,n.width(),n.height()),i.beginPath(),i.lineWidth=2,i.strokeStyle="#5aa",i.transform(1,0,0,1,2-t.left,2-t.top);for(var o=[],a=0;a<e.length;a++)switch(e[a][0]){case"m":i.moveTo(e[a][1],e[a][2]);break;case"l":i.lineTo(e[a][1],e[a][2]);break;case"c":o.push(e[a][1],e[a][2]),6===o.length&&(i.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]),o=[]);break;case"h":4===o.length?(i.bezierCurveTo(o[0],o[1],o[2],o[3],e[a][1],e[a][2]),o=[]):i.lineTo(e[a][1],e[a][2]),i.closePath()}i.stroke(),n.css({left:t.left,top:t.top}).show()}(je.generatePoints(a,s,i.pathType),n,t.shapeDom)}}))}},{key:"destroyPageHandler",value:function(){this.destroyHooks.forEach((function(e){return e()})),this.resetHandler()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.currentComponet&&this.currentComponet.destroy()}}],[{key:"setAddon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e?e.pdfViewer:null;t&&(t.getIoC().getInstanceByClass($e).addon=e)}},{key:"getStateName",value:function(){return"add-path-object"}},{key:"setPathType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.getIoC().getInstanceByClass($e).pathType=t}}]),i}(Fe),Me=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,i=Ee(r),o=_e(r);return{x:i-n.left-t.deltaX,y:o-n.top-t.deltaY}};function Ve(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Ge(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ve(o,r,i,a,s,"next",e)}function s(e){Ve(o,r,i,a,s,"throw",e)}a(void 0)}))}}function We(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var Xe=d.Deps.jQuery,Ye=d.IStateHandler,Ke=d.Events,ze=d.shared.QueuedAsyncTaskExecutor,qe=function e(){t(this,e),this.addon=null},Qe=function(e){l(i,e);var n=p(i);function i(e){return t(this,i),n.call(this,e)}return r(i,[{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n,r,i=this.pdfViewer.getIoC().getInstanceByClass(qe),o=this.$handler=e.$handler,a=o[0],s=this.hammer=new Hammer.Manager(a,{recognizers:[[Hammer.Tap],[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),c=new ze;function l(){return u.apply(this,arguments)}function u(){return(u=Ge((function(){var t,i,a,s,c,l,u,p;return We(this,(function(h){switch(h.label){case 0:return r?[2,r]:[4,et(n)];case 1:return t=h.sent(),i=t.width,a=t.height,s=e.getRotation(),c=3*i/e.page.getPxWidth(),l=3*a/e.page.getPxHeight(),(c>1||l>1)&&((u=Math.max(c,l))>1&&(u=1/u),i*=u,a*=u),90!==s&&270!==s||(p=i,i=a,a=p),r=Xe('<img style="position: absolute;top:200%;left:0;border:2px solid transparent; width:'.concat(i,"px; height:").concat(a,'px" src="').concat(n,'"/>')),o.append(r),[2,r]}}))}))).apply(this,arguments)}this.pdfViewer.eventEmitter.on(Ke.addEditImage,this.loadFile=function(e){n=e}),o.off("mouseenter").on("mouseenter",(function(e){n&&c.exec(Ge((function(){return We(this,(function(e){switch(e.label){case 0:return[4,l()];case 1:return e.sent().show(),[2]}}))})))})),o.off("mousemove mousewheel").on("mousemove mousewheel",(function(e){if(n){var t=a.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top;c.exec(Ge((function(){return We(this,(function(e){switch(e.label){case 0:return[4,l()];case 1:return e.sent().css({top:i,left:r}),[2]}}))})))}})),o.off("mouseleave").on("mouseleave",(function(e){n&&c.exec(Ge((function(){return We(this,(function(e){switch(e.label){case 0:return[4,l()];case 1:return e.sent().hide(),[2]}}))})))}));var p,h=!0,d=this;s.on("tap",(p=Ge((function(r){var o,s,c,u,p;return We(this,(function(f){switch(f.label){case 0:return h?(h=!1,n?(o={},s=Je(a,r),[4,l()]):[2]):[2];case 1:return c=f.sent(),u=c.width(),p=c.height(),e.getPDFPage().then((function(r){var a,l=e.getRotation(),f=3*u/r.getPxWidth(),v=3*p/r.getPxHeight();if(f>1||v>1){var g=Math.max(f,v);g>1&&(g=1/g),u*=g,p*=g}if(90===l||270===l){var m=u;u=p,p=m}o.top=s.y,o.left=s.x,o.right=o.left+u,o.bottom=o.top+p,(a=n,new Promise((function(e,t){var n=new XMLHttpRequest;n.open("GET",a),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&(n.status>=200&&n.status<300||304===n.status?e(n.response):t())},n.onerror=function(){t()},n.send()}))).then((function(n){var a=r.reverseDeviceRect(o,e.getScale(),l);r.addImage(n,a,l).then((function(t){if(!t)return d.pdfViewer.getStateHandlerManager().switchTo("edit-all"),c.remove(),d.currentComponet=null,void d.pdfViewer.activeElement();var n=new(i.addon.graphicsManager.get(t))(t,e,i.addon);d.pdfViewer.getStateHandlerManager().switchTo("edit-all"),d.currentComponet=n,c.remove(),h=!0,d.pdfViewer.activeElement(n)})).catch((function(e){e&&console.error(e),t.currentComponet=null,t.pdfViewer.activeElement()}))}))})),[2]}}))})),function(e){return p.apply(this,arguments)}))}},{key:"destroyPageHandler",value:function(){this.$handler.off("mousemove mousewheel mouseleave"),this.$handler.empty(),this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.pdfViewer.eventEmitter.off(Ke.addEditImage,this.loadFile)}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"setAddon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e?e.pdfViewer:null;t&&(t.getIoC().getInstanceByClass(qe).addon=e)}},{key:"getStateName",value:function(){return"add-image-object"}}]),i}(Ye),Je=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,i=Ee(r),o=_e(r);return{x:i-n.left-t.deltaX,y:o-n.top-t.deltaY}};var Ze=new Map;function et(e){return Ze.has(e)?Promise.resolve(Ze.get(e)):new Promise((function(t,n){var r=new Image;r.setAttribute("crossOrigin","Anonymous"),r.onload=function(){var n=r.width,i=r.height;Ze.set(e,{imageURL:e,width:n,height:i}),t({imageURL:e,width:n,height:i})},r.onerror=function(){n("Fail to load image:"+e)},r.src=e}))}var tt,nt="fv__add-text-object-state-handler",rt=d.Deps.Hammer;!function(e){e[e.ALL=0]="ALL",e[e.TEXT=1]="TEXT",e[e.PATH=2]="PATH",e[e.IMAGE=3]="IMAGE",e[e.SHADING=4]="SHADING",e[e.FORM_X_OBJECT=5]="FORM_X_OBJECT"}(tt||(tt={}));var it=d.shared.areaSelections,ot=it.Selections,at=it.SelectionEventType,st=it.createAreaLimitationReducer,ct=it.BorderStyle,lt=d.Deps.Hammer,ut=d.shared.activation.ActivationGroup,pt=d.shared.keyboardStatus,ht=d.shared.QueuedAsyncTaskExecutor,dt={};function ft(e){var n=e.graphicsManager,i="fv__edit-all-state-handler fv__edit-graphics-state-handler";return function(o){l(s,o);var a=p(s);function s(e){var n;return t(this,s),(n=a.call(this,e)).destroyHooks=[],n}return r(s,[{key:"pageHandler",value:function(t){var r=this,o=new ut;this.pageRender=t;var a=t.getPDFPage(),s=t.$handler,c=s[0];s.addClass(i);var l=new ht;this.selections=new ot({anchorElement:c,borderStyle:ct.DOTTED}),this.selections.reducer(st(c)),this.selections.reducer((function(e){if(void 0!==e){var t=c.getBoundingClientRect();return Object.assign({left:e.clientLeft-t.left,top:e.clientTop-t.top},e)}})),this.selections.eventInterceptor((function(e){return e.target===c}));var u=!1;this.selections.eventInterceptor((function(e){return u}));var p=function(e){u=e.target===c};c.addEventListener("mousedown",p),c.addEventListener("touchstart",p),this.destroyHooks.push((function(){c.removeEventListener("mousedown",p),c.removeEventListener("touchstart",p)})),this.selections.on(at.END,(function(i){l.exec((function(){return a.then((function(a){var s=r.pageRender.scale,c=r.pageRender.getRotation(),l=a.reverseDeviceRect({left:i.left,right:i.left+i.width,top:i.top,bottom:i.top+i.height},s,c),u=Math.min(2/r.pageRender.scale,2);return a.getGraphicsObjectsInRect(l,u,tt.ALL).then((function(i){!i||i.length<1||(f()||o.clear(),r.pdfViewer.activeElement(o),i.forEach((function(r){var i=r.getRect();if(!(i.right-i.left<1||i.top-i.bottom<1)){var a=new(n.get(r))(r,t,e);o.add(a)}})),r.pdfViewer.eventEmitter.emit(d.Events.activeElementChanged))}))}))}))}));var h=this.hammer=new lt(c);h.on("tap",(function(i){r.resetHandler();var s,l,u,p,h,v=(s=i,l=c.getBoundingClientRect(),u=s.srcEvent,p=Ee(u),h=_e(u),{x:p-l.left-s.deltaX,y:h-l.top-s.deltaY});a.then((function(e){return[e,e.reverseDevicePoint([v.x,v.y],t.getScale(),t.getRotation())]})).then((function(e){var t=R(e,2),n=t[0],r=R(t[1],2),i=r[0],o=r[1];return n.getGraphicsObjectAtPoint([i,o],5,0)})).then((function(e){return e?e.type<1||e.type>3?Promise.reject():[n.get(e),e]:Promise.reject(dt)})).then((function(n){var r=R(n,2);return new(0,r[0])(r[1],t,e)})).then((function(e){if(r.currentComponent=e,f()){var t=i.target.closest(".fwr__graphics-object-handler");if(t){var n=o.activations.find((function(e){return!!e.$handler&&e.$handler.get(0)===t}));if(n)return o.remove(n),void r.pdfViewer.activeElement(o)}}else o.clear();o.add(e),r.pdfViewer.activeElement(o),r.pdfViewer.eventEmitter.emit(d.Events.tapGraphicsObject,e.getGraphicsObject())})).catch((function(e){e===dt&&f()||(e!==dt&&e&&console.error(e),r.currentComponent=null,r.pdfViewer.activeElement())}))})),this.destroyHooks.push((function(){return h.destroy()}),(function(){return r.selections.destroy()}),(function(){o.clear(),r.pdfViewer.unActiveElement(o)}));var f=function(){return!!r.pdfViewer.isShortcutKeyEnabled()&&(d.DeviceInfo.isMac?pt.isWin:pt.isCtrl)}}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.destroyHooks.forEach((function(e){return e()})),this.pageRender.$handler.removeClass(i),this.resetHandler(),this.pageRender=null,this.destroyHooks=null}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.currentComponent&&this.currentComponent.textCharSure&&this.currentComponent.textCharSure()}}],[{key:"getStateName",value:function(){return"edit-all"}}]),s}(d.IStateHandler)}var vt=function(){function e(n){t(this,e),this.pdfViewer=n,this.graphicsManager=new ke,this.pdfViewer.addon=this}return r(e,[{key:"init",value:function(){var e,n,i,o=this,a=function(e){var n=e.graphicsManager,i="text",o=i?["fv__edit-",i,"-state-handler"].join(""):"";return o+=" fv__edit-graphics-state-handler",function(a){l(c,a);var s=p(c);function c(e){return t(this,c),s.call(this,e)}return r(c,[{key:"pageHandler",value:function(t){var r=this;this.pageRender=t;var i=t.$handler,a=i[0];i.addClass(o);var s=this.hammer=new Oe.Manager(a,{recognizers:[[Oe.Pan,{direction:Oe.DIRECTION_ALL}]]});s.add(new Oe.Tap({event:"doubletap",taps:2})),s.add(new Oe.Tap({event:"singletap"})),s.get("doubletap").recognizeWith("singletap"),s.get("singletap").requireFailure("doubletap"),s.on("singletap",(function(i){r.resetHandler();var o=i.changedPointers[0];t.getPDFPage().then((function(e){return[e,e.reverseDevicePoint([o.offsetX,o.offsetY],t.getScale(),t.getRotation())]})).then((function(e){var t=R(e,2),n=t[0],r=R(t[1],2),i=r[0],o=r[1];return n.getGraphicsObjectAtPoint([i,o],3,1)})).then((function(e){return e?[n.get(e),e]:Promise.reject(new Error("Text object not found at this position: [".concat(o.offsetX,", ").concat(o.offsetY,"]")))})).then((function(n){var r=R(n,2);return new(0,r[0])(r[1],t,e)})).then((function(e){return r.currentComponet=e,e.active()})).catch((function(e){e&&console.error(e),r.currentComponet=null,r.pdfViewer.activeElement()}))})),s.on("doubletap",(function(i){r.resetHandler();var o=i.changedPointers[0];t.getPDFPage().then((function(e){return[e,e.reverseDevicePoint([o.offsetX,o.offsetY],t.getScale(),t.getRotation())]})).then((function(e){var t=R(e,2),n=t[0],r=R(t[1],2),i=r[0],o=r[1];return n.getGraphicsObjectAtPoint([i,o],3,1)})).then((function(e){return e?[n.get(e),e]:Promise.reject(new Error("Text object not found at this position: [".concat(o.offsetX,", ").concat(o.offsetY,"]")))})).then((function(n){var r=R(n,2);return new(0,r[0])(r[1],t,e)})).then((function(e){return r.currentComponet=e,e.activeCharEdit()})).catch((function(e){e&&console.error(e),r.currentComponet=null,r.pdfViewer.activeElement()}))}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(o),this.resetHandler()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.currentComponet&&(this.currentComponet.textCharSure&&this.currentComponet.textCharSure(),this.currentComponet.unActive())}}],[{key:"getStateName",value:function(){return"edit-"+i}}]),c}(d.IStateHandler)}(this),s=De(this,2),c=De(this,3),u=ft(this),h=(n=(e=this).graphicsManager,i=function(){function e(){t(this,e),this.currentEditingGraphicComponent=null}return r(e,[{key:"allInjected",value:function(){var e=this;this.pdfViewer.eventEmitter.on(d.ViewerEvents.willCloseDocument,(function(){e.currentEditingGraphicComponent&&e.currentEditingGraphicComponent.isActive&&e.currentEditingGraphicComponent.unActive(),e.currentEditingGraphicComponent=null}))}},{key:"applyCurrent",value:function(){var e=this.currentEditingGraphicComponent;e&&(e.textCharSure&&e.textCharSure(),e.unActive(),this.currentEditingGraphicComponent=null)}}],[{key:"inject",value:function(){return{pdfViewer:d.PDFViewer}}}]),e}(),function(o){l(s,o);var a=p(s);function s(e){var n;return t(this,s),(n=a.call(this,e)).service=e.getIoC().getInstanceByClass(i),n}return r(s,[{key:"pageHandler",value:function(t){var r=this;this.pageRender=t;var i=t.getPDFPage(),o=t.$handler,a=o[0];o.addClass(nt),(this.hammer=new rt(a)).on("tap",(function(o){r.resetHandler();var a=o.changedPointers[0];i.then((function(e){return[e,e.reverseDevicePoint([a.offsetX,a.offsetY],t.getScale(),t.getRotation())]})).then((function(e){var n=R(e,2),i=n[0],o=R(n[1],2),a=o[0],s=o[1],c=i.getRotationAngle(),l=new d.Matrix;l.rotate((c+t.getRotation())/180*Math.PI),l.translate(a,s);var u=r.pdfViewer.store.getCurrentValue("add-text-object-param-transfer");return i.addGraphicsObject(Object.assign({},u,{originPosition:{x:a,y:s}},{type:1,matrix:l.toArray()}))})).then((function(e){return e?[n.get(e),e]:Promise.reject(new Error("Graphics object was not created!"))})).then((function(n){var r=R(n,2);return new(0,r[0])(r[1],t,e)})).then((function(e){return r.service.currentEditingGraphicComponent=e,r.currentGraphicComponent=e,e.activeCharEdit()})).catch((function(e){e&&console.error(e),r.service.currentEditingGraphicComponent=null,r.currentGraphicComponent=null,r.pdfViewer.activeElement()}))}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(nt),this.pdfViewer.getEventEmitter().off(x.addTextObjectParamTransfer,this.addTextObjectParamTransferBind),this.resetHandler()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.service.currentEditingGraphicComponent&&this.service.applyCurrent()}}],[{key:"getStateName",value:function(){return"add-text-object"}}]),s}(d.IStateHandler)),f=this.pdfViewer.getStateHandlerManager();[a,s,c,u,Ue,h,Qe].forEach((function(e){e.setAddon&&e.setAddon(o),f.register(e)})),this.pdfViewer.addDestroyHook((function(){Ue.setAddon(null,o.pdfViewer),Qe.setAddon(null,o.pdfViewer)}))}},{key:"getGraphicsManager",value:function(){return this.graphicsManager}}]),e}(),gt=o(485),mt=o.n(gt);var yt=0,Et=1,_t={0:"None",1:"Square",2:"Circle",3:"Diamond",4:"OpenArrow",5:"ClosedArrow",6:"Butt",7:"ROpenArrow",8:"RClosedArrow",9:"Slash"},bt=(Object.keys(_t).reduce((function(e,t){return e[_t[t]]=Number(t),e}),{}),Promise.resolve(),function(e){l(i,e);var n=p(i);function i(){return t(this,i),n.apply(this,arguments)}return r(i,[{key:"handle",value:function(e){if(this.getPDFUI().checkAppSignIn()){var t=this.component.parent.getCurrentTarget();t.moveToPosition&&t.moveToPosition(yt,null)}}}],[{key:"getName",value:function(){return"MoveFrontGraphicsObjectController"}}]),i}(h.Controller)),Ct=function(e){l(i,e);var n=p(i);function i(){return t(this,i),n.apply(this,arguments)}return r(i,[{key:"handle",value:function(e){if(this.getPDFUI().checkAppSignIn()){var t=this.component.parent.getCurrentTarget();t.moveToPosition&&t.moveToPosition(Et,null)}}}],[{key:"getName",value:function(){return"MoveBackGraphicsObjectController"}}]),i}(h.Controller),Tt=function(e){l(i,e);var n=p(i);function i(){return t(this,i),n.apply(this,arguments)}return r(i,[{key:"initDialog",value:function(){var e=this,t="fv--graphics-object-properties-dialog";this.pdfUI.registerDialog(t,(function(n){return e[t]?Promise.resolve(e[t]):e.pdfUI.getComponentByName("template-container").then((function(n){return e[t]=n.append("<edit-graphics:graphic-object-properties-dialog></edit-graphics:graphic-object-properties-dialog>")}))}))}},{key:"handle",value:function(e){this.getPDFUI().checkAppSignIn()&&(this.isInitDialog||(this.initDialog(),this.isInitDialog=!0),this.pdfUI.openDialog("fv--graphics-object-properties-dialog").then((function(t){t.showAt(e.pageX,e.pageY)})))}}],[{key:"getName",value:function(){return"ShowGraphicsObjectPropertiesController"}}]),i}(h.Controller),At=function(e){l(i,e);var n=p(i);function i(){return t(this,i),n.apply(this,arguments)}return r(i,[{key:"handle",value:function(){if(this.getPDFUI().checkAppSignIn()){var e=this.component.parent.getCurrentTarget();e.remove&&e.remove()}}}],[{key:"getName",value:function(){return"DeleteGraphicsObjectController"}}]),i}(h.Controller),St=function(e){l(o,e);var n=p(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"init",value:function(e){var t=this;s(i(o.prototype),"init",this).call(this,e);var n=e.getPDFUI();n.getPDFViewer().then((function(r){t.addDestroyHook(n.addViewerEventListener(h.PDFViewCtrl.Events.activeElementChanged,(function(){r.getAllActivatedElements().some((function(e){return e.graphicsObject&&1===e.graphicsObject.info.type}))?e.deactive():e.active()})))}))}}],[{key:"getName",value:function(){return"check-activates"}}]),o}(h.Directive),Rt=o(125),xt=o.n(Rt),wt=h.PDFViewCtrl.shared.colorConvertor,kt={},Pt=[[],[2,2,2,2],[3,3,3,3],[4,4,4,4],[4,3,2,3],[8,4,4,4],[4,3,16,3]];var Dt=function(){function e(){t(this,e)}return r(e,[{key:"getMergedPropertiesOfActivateElements",value:function(e){var t=this,n=e.filter((function(e){return!!e.graphicsObject})).map((function(e){switch(e.graphicsObject.info.type){case 3:return t.exportImageProperties(e);case 2:return t.exportPathProperties(e)}})).filter(Boolean);return this.mergeAllProperties(n)}},{key:"mergeAllProperties",value:function(e){if(0===e.length)return{isEmpty:!0};var t=e.map((function(e){return Object.keys(e)}));return t.sort((function(e,t){return e.length>t.length?1:-1})),t[0].reduce((function(t,n){return t[n]=function(t){var n=e[0][t];if(e.slice(1).some((function(e){return e[t]!==n})))return kt;return n}(n),t}),{})}},{key:"exportImageProperties",value:function(e){return{opacity:100*e.getPropertyOptions().opacity}}},{key:"exportPathProperties",value:function(e){var t=e.graphicsObject,n=e.getPropertyOptions(),r=n.color,i=n.opacity,o=n.fillColor;return{borderWidth:n.borderWidth,borderStyle:function(e){var t=e.getBorderStyle(),n=0,r=e.getBorderDashes();if(1==t&&r.length>0){var i=Math.max.apply(Math,r),o=Math.min.apply(Math,r);n=o==i?o>3?3:o>2?2:o<2||2==o?1:3:i>8?6:i>4?5:4}return n}(t),borderColor:r,fillColor:0===o?0:wt(o,"#"),opacity:100*i}}},{key:"applyOpacityChange",value:function(e,t){e!==t.graphicsObject.getOpacity()&&t.setOpacity(e)}},{key:"applyBorderWidthChange",value:function(e,t){e!==t.graphicsObject.getBorderWidth()&&t.setBorderWidth(e)}},{key:"applyBorderColorChange",value:function(e,t){var n=0===e?0:wt(e,"int");n!==t.graphicsObject.getBorderColor()&&t.setColor(n)}},{key:"applyFillColorChange",value:function(e,t){var n=0==e?0:wt(e,"int");n!==t.graphicsObject.getFillColor()&&t.setFillColor(n)}},{key:"applyBorderStyleChange",value:function(e,t){var n,r=R([0===(n=e)?0:1,Pt[n]],2),i=r[0],o=r[1];t.setBorderStyle(i,o)}},{key:"isAllSame",value:function(e,t){return e[t]!==kt}}]),e}(),Ht=h.PDFViewCtrl,Ot=Ht.DeviceInfo.isMobile,It=Ht.ViewerEvents,jt=h.PDFViewCtrl.keyboard.KeyboardUtils.matchers.Escape,Lt=Ht._internal.shared.attachKeypressEvent,Nt=function(e){l(o,e);var n=p(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"init",value:function(){s(i(o.prototype),"init",this).call(this),this.title="ega:graphics-properties.dialog.title",this.properties={},this.digest()}},{key:"mounted",value:function(){var e=this;s(i(o.prototype),"mounted",this).call(this);var t=this.getPDFUI(),n=this.graphicsObjectService;this.addDestroyHook(t.addViewerEventListener(It.activeElementChanged,(function(){e.isVisible&&e.updateActivatedElements()})),this.watchProperty("fillColor",(function(t){var r="string"==typeof t?t:"transparent";e.fillColorMaskElement.style.backgroundColor=r,"object"!=typeof t&&void 0!==t&&e.forEachGraphicObject((function(e){n.applyFillColorChange(t,e)}))})),this.watchProperty("borderColor",(function(t){var r="string"==typeof t?t:"transparent";e.borderColorMaskElement.style.backgroundColor=r,"object"!=typeof t&&void 0!==t&&e.forEachGraphicObject((function(e){n.applyBorderColorChange(t,e)}))})),this.watchProperty("opacity",(function(t){"object"!=typeof t&&void 0!==t&&e.forEachGraphicObject((function(e){n.applyOpacityChange(t/100,e)}))})),this.watchProperty("borderWidth",(function(t){"object"!=typeof t&&void 0!==t&&e.forEachGraphicObject((function(e){n.applyBorderWidthChange(t,e)}))})),this.watchProperty("borderStyle",(function(t){"object"!=typeof t&&void 0!==t&&e.forEachGraphicObject((function(e){n.applyBorderStyleChange(t,e)}))})),Lt(this.element,(function(t){e.hide(),t.stopPropagation()}),jt))}},{key:"watchProperty",value:function(e,t){var n=this;return this.watch("$component.properties.".concat(e),(function(r){n.supportsProperty(e)&&t(r)}))}},{key:"supportsProperty",value:function(e){return e in(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.properties)}},{key:"forEachGraphicObject",value:function(e){return this.getPDFUI().getAllActivatedElements().then((function(t){t.forEach((function(t){t.graphicsObject&&e(t)}))}))}},{key:"showAt",value:function(e,t){s(i(o.prototype),"show",this).call(this),this.updateActivatedElements(),Ot||this.resetPosition(e,t)}},{key:"resetPosition",value:function(e,t){var n=this.getRoot().element,r=this.element,i=r.offsetWidth,o=r.offsetHeight;e+i>n.offsetWidth?r.style.left=n.offsetWidth-i+"px":r.style.left=e+"px",t+o>n.offsetHeight?r.style.top=n.offsetHeight-o+"px":r.style.top=t+"px"}},{key:"updateActivatedElements",value:function(){var e=this;this.getPDFUI().getAllActivatedElements().then((function(t){var n=e.graphicsObjectService.getMergedPropertiesOfActivateElements(t);if(n.isEmpty)e.hide();else{var r=Array.from(new Set(t.filter((function(e){return!!e.graphicsObject})).map((function(e){return e.graphicsObject.getType()}))));if(1!==r.length)e.title="ega:graphics-properties.dialog.title";else switch(r[0]){case 2:e.title="ega:graphics-properties.dialog.path-title";break;case 3:e.title="ega:graphics-properties.dialog.image-title"}e.correctPropertyKeys=Object.keys(n),e.properties=n,e.digest(),e.updateUIByProperties(n)}}))}},{key:"updateUIByProperties",value:function(e){this.updateBorderWidthUI(e),this.updateBorderStyleUI(e),this.updateBorderColorUI(e),this.updateFillColorUI(e),this.updateOpacityUI(e)}},{key:"updateBorderWidthUI",value:function(e){this.supportsProperty("borderWidth",e)?(this.borderWidthFieldset.show(),this.graphicsObjectService.isAllSame(e,"borderWidth")||(this.borderWidthElement.element.value="")):this.borderWidthFieldset.hide()}},{key:"updateBorderStyleUI",value:function(e){this.supportsProperty("borderStyle",e)?(this.borderStyleFieldset.show(),this.graphicsObjectService.isAllSame(e,"borderStyle")?this.borderStyleChoice.setValue(e.borderStyle):this.borderStyleChoice.element.querySelector(".fv__ui-select-lable").className="fv__ui-select-lable"):this.borderStyleFieldset.hide()}},{key:"updateBorderColorUI",value:function(e){this.supportsProperty("borderColor",e)?(this.borderColorFieldset.show(),this.graphicsObjectService.isAllSame(e,"borderColor")||(this.borderColorMaskElement.style.backgroundColor="transparent")):this.borderColorFieldset.hide()}},{key:"updateFillColorUI",value:function(e){this.supportsProperty("fillColor",e)?(this.fillColorFieldset.show(),this.graphicsObjectService.isAllSame(e,"fillColor")||(this.fillColorMaskElement.style.backgroundColor="transparent")):this.fillColorFieldset.hide()}},{key:"updateOpacityUI",value:function(e){this.supportsProperty("opacity",e)?(this.opacityInputFieldset.show(),this.opacitySlider.show(),this.graphicsObjectService.isAllSame(e,"opacity")||(this.opacityInput.element.value="")):(this.opacityInputFieldset.hide(),this.opacitySlider.hide())}},{key:"toggleLock",value:function(e){e?this.appearanceTabBody.lock():this.appearanceTabBody.unlock()}},{key:"borderStyleChanged",value:function(e){this.properties.borderStyle=e,this.digest()}},{key:"showColorPicker",value:function(e,t){var n=this,r=this.getPDFUI().colorSpectrum;switch(e){case"fillColor":var i=this.properties.fillColor;"object"==typeof i&&(i=0),r.showTransparent(!0).setDefaultColor(i),r.show(t.element,(function(e){n.properties.fillColor=e,n.digest()}));break;case"borderColor":var o=this.properties.borderColor;"object"==typeof o&&(o=0),r.showTransparent(!0).setDefaultColor(o),r.show(t.element,(function(e){n.properties.borderColor=e,n.digest()}))}}}],[{key:"getName",value:function(){return"graphic-object-properties-dialog"}},{key:"services",value:function(){return{graphicsObjectService:Dt}}}]),o}(h.SeniorComponentFactory.createSuperClass({template:xt()(),fragments:[{target:"graphics-property-borderStyle",config:{iconclass:"fv__ui-property-icon-border-style",noOptionLable:!0,selectorClass:"fv__ui-border-style-selector",options:Array(7).fill(0).map((function(e,t){return{value:t,class:"fv__ui-line-style-"+t}}))}}]})),Bt=function(e){l(o,e);var n=p(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"init",value:function(e){var t=this;s(i(o.prototype),"init",this).call(this,e),e.getPDFViewer().then((function(e){(t.addon=new vt(e)).init()}))}},{key:"receiveAction",value:function(e,t){if("getGraphicsObjectComponent"===e){var n=t.graphicsObject,r=t.pageRender;return new(this.addon.getGraphicsManager().get(n))(n,r,this.addon)}}}],[{key:"getName",value:function(){return"edit-graphics"}},{key:"getLoader",value:function(){return mt()}},{key:"initOnLoad",value:function(){var e=h.modular.module("edit-graphics",[]);e.registerController(Tt),e.registerController(bt),e.registerController(Ct),e.registerController(At),e.registerComponent(Nt),e.getRegistry().registerDirective(St),e.registerPreConfiguredComponent("contextmenu-item-properties",{template:'<contextmenu-item @controller="edit-graphics:ShowGraphicsObjectPropertiesController">ega:contextmenu.properties</contextmenu-item>'}),e.registerPreConfiguredComponent("contextmenu-item-set-to-front",{template:'<contextmenu-item @controller="edit-graphics:MoveFrontGraphicsObjectController">ega:contextmenu.set-to-front</contextmenu-item>'}),e.registerPreConfiguredComponent("contextmenu-item-set-to-back",{template:'<contextmenu-item @controller="edit-graphics:MoveBackGraphicsObjectController">ega:contextmenu.set-to-back</contextmenu-item>'}),e.registerPreConfiguredComponent("contextmenu-item-delete",{template:'<contextmenu-item @controller="edit-graphics:DeleteGraphicsObjectController">ega:contextmenu.delete</contextmenu-item>'}),e.registerPreConfiguredComponent("image-contextmenu",{template:'\n            <contextmenu name="fv--image-graphics-object-contextmenu" @edit-graphics:check-activates>\n                <edit-graphics:contextmenu-item-set-to-front name="fv--contextmenu-item-image-graphics-object-set-to-front"></edit-graphics:contextmenu-item-set-to-front>\n                <edit-graphics:contextmenu-item-set-to-back name="fv--contextmenu-item-image-graphics-object-set-to-back"></edit-graphics:contextmenu-item-set-to-back>\n                <edit-graphics:contextmenu-separator></edit-graphics:contextmenu-separator>\n                <edit-graphics:contextmenu-item-delete name="fv--contextmenu-item-image-graphics-object-delete"></edit-graphics:contextmenu-item-delete>\n                <edit-graphics:contextmenu-separator></edit-graphics:contextmenu-separator>\n                <edit-graphics:contextmenu-item-properties name="fv--contextmenu-item-image-graphics-object-properties"></edit-graphics:contextmenu-item-properties>\n            </contextmenu>\n            '})}}]),o}(h.UIXAddon)})(),a=a.default})()));